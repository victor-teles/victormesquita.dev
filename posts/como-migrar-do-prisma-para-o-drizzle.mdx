---
title: Como migrar do Prisma para o Drizzle
description: Guia passo a passo para uma transi√ß√£o tranquila e sem sofrimentos.
slug: como-migrar-do-prisma-para-o-drizzle
date: Nov 1, 2024
published: true
---

Recentemente realizei uma migra√ß√£o de uma `codebase` de um projeto que utilizava o [Prisma](https://prisma.io/) para o [Drizzle](https://drizzle.org/),
e resolvi compartilhar algumas experi√™ncias que (eu sofri mas voc√™ n√£o precisa) talvez possam ser √∫teis para voc√™.

Antes de comer√ßar, o Drizzle ORM (ou somente Drizzle) √© um Object Relational Mapper (ORM) leve, r√°pido e *typesafe*.
Ele permite que voc√™ escreva suas queries no formato similar ao SQL e oferece suporte nativo a serverless.


## Principais vantagens do Drizzle

Vamos falar um pouco sobre as principais vantagens do Drizzle em rela√ß√£o √† outros ORMs e entender o porqu√™ de migrar para ele.

### Escrevendo SQL com seguran√ßa

O Drizzle permite que voc√™ escreva consultas que se assemelham muito ao SQL, por√©m s√£o escritas utilizando typescript, que permite a verifica√ß√£o de tipagem est√°tica. Isso significa que voc√™ pode aproveitar o "autocomplete" do seu editor e tamb√©m evitar erros comuns de sintaxe. 

Um exemplo simples de uma query para buscar um usu√°rio pelo ID:

```typescript
import { eq } from 'drizzle-orm';
import { users } from './schema';

// !callout[/user/] SELECT * FROM users WHERE id = 1;
const user = await db.select().from(users).where(eq(users.id, 1));
```

### Perform√°tico

Ele foi projetado para ser r√°pido e eficiente, minimizando a sobrecarga que alguns ORMs tradicionais podem introduzir. Isso √© especialmente ben√©fico em ambientes serverless ou de alto impacto, onde a performance √© crucial.

Ainda n√£o est√° convencido? Da uma olhada nesse benchmark üëá

<DrizzleBenchmark />

### Comunidade crescente e ativa

Apesar de ser relativamente novo, o Drizzle tem uma comunidade ativa e em crescimento. 
Isso significa que voc√™ pode encontrar suporte, tutoriais e exemplos que ser√£o de grande ajuda na hora de aprender e resolver problemas.

- [Discord](https://discord.com/invite/tCe773yFeZ)
- [Twitter](https://x.com/drizzleorm)

## Passo a passo para migrar

<Stepper className="vertical-stepper">

<Step title="Analisar o esquema atual">

Antes de come√ßar, √© importante entender como est√° estruturado o seu esquema no Prisma. Revise os modelos definidos no arquivo `schema.prisma` e identifique as tabelas, rela√ß√µes e campos principais.

</Step>

<Step title="Criar o esquema no Drizzle">

No Drizzle, voc√™ define o esquema utilizando TypeScript. Aqui est√° um exemplo de como migrar um modelo simples:

<CodeSwitcher
  type="switch"
  lang="typescript"
  prismaCode={`model User {
  id    Int     @id @default(autoincrement())
  name  String
  email String  @unique
  posts Post[]
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String?
  authorId  Int
  author    User     @relation(fields: [authorId], references: [id])
}`}
  drizzleCode={`import { integer, pgTable, serial, text, varchar } from 'drizzle-orm/pg-core';
import { relations } from 'drizzle-orm';

export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  name: varchar('name', { length: 255 }),
  email: varchar('email', { length: 255 }).unique(),
});

export const posts = pgTable('posts', {
  id: serial('id').primaryKey(),
  title: varchar('title', { length: 255 }),
  content: text('content').nullable(),
  authorId: integer('author_id').references(() => users.id),
});

export const userRelations = relations(users, ({ many }) => ({
  posts: many(posts),
}));`}
/>

</Step>

<Step title="Configurar a conex√£o com o banco">

No Prisma, a conex√£o com o banco √© configurada no arquivo `prisma/.env`. No Drizzle, voc√™ pode configurar a conex√£o diretamente no c√≥digo:

<CodeSwitcher
  type="switch"
  lang="typescript"
  prismaCode={`import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

export default prisma`}
  drizzleCode={`import { drizzle } from 'drizzle-orm/node-postgres';
import { Pool } from 'pg';

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

export const db = drizzle(pool);`}
/>

</Step>

<Step title="Migrar queries">

Agora, √© hora de migrar as queries. Aqui est√£o alguns exemplos de como converter queries comuns do Prisma para o Drizzle:

<CodeSwitcher
  type="switch"
  lang="typescript"
  prismaCode={`const user = await prisma.user.findUnique({
  where: { id: 1 },
   include: {
    posts: true,
  },
});`}
  drizzleCode={`import { eq } from 'drizzle-orm';

const userWithPosts = await db.query.users.findFirst({
  where: eq(users.id, 1),
  with: {
    posts: true
  },
});`}
/>

</Step>

<Step title="Testar e validar">

Ap√≥s migrar o esquema e as queries, teste sua aplica√ß√£o para garantir que tudo est√° funcionando como esperado. Verifique se as consultas est√£o retornando os dados corretos e se o desempenho est√° adequado.

</Step>

</Stepper>

## Conclus√£o

Migrar para o Drizzle pode parecer uma tarefa desafiadora, mas, seguindo um passo a passo estruturado se torna um processo tranquilo!

Ent√£o para come√ßar, eu recomendo iniciar com um projeto pequeno para se familiarizar com o processo e, aos poucos, entender como o ORM funciona antes de migrar projetos maiores!

Obrigado por ler at√© aqui! 